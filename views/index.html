<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>商城主页</title>
    <link rel="stylesheet" href="css/bootstrap.css"/>
    <link rel="stylesheet" href="css/index.css"/>
    <link rel="stylesheet" href="css/product.css"/>
    <script src="js/jquery.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script charset="UTF-8">
        $(document).ready(function(){
            //鼠标悬停触发事件
            $("#hover_dropdown").hover(function(){
                $(".dropdown-toggle").dropdown('toggle');
            });

            //书本展示
            showBooks();

            //搜索栏
            $("#searchBtn").click(function(){
                let keyword = $("#keyword").val();
                if(keyword == ''){
                    alert('请输入需要搜索的关键字！');
                }else {
                    $(location).attr('href', encodeURI('http://localhost:8080/searchResult.html?keyword=' + keyword));
                }
            });

        });
        
        function showBooks() {
            //console.log("showBooks called");
            let panels = $("div[id^='bookDisplayPanel']");
            //console.log(panels);
            let set = new Set();
            let rand;
            panels.each(function(){
                while(set.has(rand = Math.floor((Math.random() * 13) + 1)));
                set.add(rand);
                let books = '<p>haha</p>';
                $.ajax({
                    method: 'GET',
                    data:{
                        'p': rand
                    },
                    url: 'http://127.0.0.1:8080/book/findAll',
                    async: false,
                    success: function (data){
                        //console.log(data.list.length);
                        books = '<div class="row">';
                        for(let i = 0; i < 9; i++){
                            books += '<div class="col-md-4">\n' +
                                '                <div class="card mb-4 shadow-sm">\n' +
                                '                    <img src="/public/img/bookCover/' + data.list[i].bUri + '" alt="" class="book-img">\n' +
                                '                    <div class="card-body-book">\n' +
                                '                        <div class="book-info">\n' +
                                '                            <p hidden="hidden">' + data.list[i].bId + '</p>\n' +
                                '                            <p class="book-title">' + data.list[i].bName + '</p>\n' +
                                '                            <p class="book-author">' + data.list[i].bAuthor + '</p>\n' +
                                '                        </div>\n' +
                                '                        <div class="d-flex justify-content-between align-items-center">\n' +
                                '                            <div class="btn-group">\n' +
                                '                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="watchDetail(this)">查看</button>\n' +
                                '                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="addCart(this)">加入购物车</button>\n' +
                                '                            </div>\n' +
                                '                        </div>\n' +
                                '                    </div>\n' +
                                '                </div>\n' +
                                '            </div>';
                        }
                        books += '</div>';
                    }
                });
                $(this).html(books);
            });
        }

        //转到图书详情页面（未完成）
        function watchDetail(obj){
            let bId = $(obj).parents(".card-body-book").find("p:hidden").html();
            $(location).attr('href', 'http://localhost:8080/页面名称?' + bId);
        }

        //将图书加入购物车
        function addCart(obj) {
            let bookId = $(obj).parents(".card-body-book").find("p:hidden").html();
            console.log(bookId);
            //console.log(bookId);
            $.post('http://127.0.0.1:8080/cart/addBook',
                    {
                        bId: bookId
                    },
                    function(result, state){
                        switch (result) {
                            case 201:
                                console.log('uId is null');
                                break;
                            case 202:
                                console.log('bId is null');
                                break;
                            case 100:
                                console.log('成功，加入一本书到用户的购物车');
                                alert('加入成功');
                                break;
                            case 101:
                                console.log('成功，图书已存在，数量+1');
                                alert('加入成功');
                        }
                    }
            );
        }
    </script>
</head>
<body>
<!-- 顶部信息栏 -->
<div class="container">
    <div class="row clearfix sticky-top">
        <div class="col-12">
            <ul class="breadcrumb justify-content-end">
                <li class="breadcrumb-item">
                    欢迎光临xx书店，请先<a href="view/login.html">登录</a>
                </li>
                <li class="breadcrumb-item">
                    <a href="view/register.html">注册</a>
                </li>
                <li class="breadcrumb-item">
                    <div class="dropdown" id="hover_dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">我</a>
                        <ul class="dropdown-menu">
                            <li>
                                <a class="dropdown-item" href="#">账户信息</a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#">我的购物车</a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#">我的订单</a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="breadcrumb-item">
                    <a href="#">联系客服</a>
                </li>
            </ul>
        </div>
    </div>

    <!-- 网站logo + 搜索框 + 购物车按钮 -->
    <div class="row">
        <div class="col-lg-3 col-md-12">
            <a href="http://127.0.0.1:8080/index.html" class="navbar-brand"><img src="img/logo.png" alt=""/></a>
        </div>
        <div class="col-lg-5 col-md-12 mt-3">
            <div class="input-group">
<!--                <img src="img/header/search.png" alt=""/>-->
                <input type="text" id="keyword" class="form-control pt-0 pb-0" placeholder="请输入书籍名称、作者或出版社"/>
                <input type="button" id="searchBtn" value="搜索"/>
            </div>
        </div>
        <!-- 带图标的按钮 -->
        <div class="col-lg-4 col-md-12 p-0 mt-3">
<!--                <a href="#" class="btn btn-lg red">-->
<!--                    <span class="fa fa-unlock-alt fa-2x"></span>我的购物车-->
<!--                </a>-->
            <a href="#" class="btn btn-outline-danger btn-lg"><i class="glyphicon glyphicon-shopping-cart"></i> 我的购物车</a>
        </div>
    </div>

    <!-- 分类导航-->
<!--    <ul class="nav">-->
<!--        <li class="nav-item"><a href="" class="nav-link">首页</a></li>-->
<!--        <li class="nav-item"><a href="" class="nav-link">小说</a></li>-->
<!--        <li class="nav-item"><a href="" class="nav-link">散文</a></li>-->
<!--        <li class="nav-item"><a href="" class="nav-link">诗词</a></li>-->
<!--    </ul>-->

    <!-- 图片轮播 -->
    <div class="carousel" data-ride="carousel" id="demo">
        <!-- 1.轮播图片-->
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img alt="" class="w-100" src="img/lb1.png"/>
            </div>
            <div class="carousel-item">
                <img alt="" class="w-100" src="img/lb2.png"/>
            </div>
            <div class="carousel-item">
                <img alt="" class="w-100" src="img/lb3.png"/>
            </div>
            <div class="carousel-item">
                <img alt="" class="w-100" src="img/lb4.png"/>
            </div>
        </div>
        <!-- 2.左右箭头-->
        <a class="carousel-control-next" data-slide="next" href="#demo">
            <span class="carousel-control-next-icon"></span>
        </a>
        <a class="carousel-control-prev" data-slide="prev" href="#demo">
            <span class="carousel-control-prev-icon"></span>
        </a>
        <!-- 3.轮播指示符-->
        <ul class="carousel-indicators">
            <li class="active" data-slide-to="0" data-target="#demo"></li>
            <li data-slide-to="1" data-target="#demo"></li>
            <li data-slide-to="2" data-target="#demo"></li>
            <li data-slide-to="3" data-target="#demo"></li>
        </ul>
    </div>

    <!-- 图书展示区 -->
    <div class="border-bottom">
<!--        <img src="img/index/computer_icon.png" alt=""/>-->
        <span class="title_font">畅销图书</span>
    </div>
    <!--    <div class="album py-5 bg-light">-->
    <div class="container" id="bookDisplayPanel1"></div>

    <div class="border-bottom">
        <!--        <img src="img/index/computer_icon.png" alt=""/>-->
        <span class="title_font">限时折扣</span>
    </div>
    <!--    <div class="album py-5 bg-light">-->
    <div class="container" id="bookDisplayPanel2"></div>

    <div class="border-bottom">
        <!--        <img src="img/index/computer_icon.png" alt=""/>-->
        <span class="title_font">最新上架</span>
    </div>
    <!--    <div class="album py-5 bg-light">-->
    <div class="container" id="bookDisplayPanel3"></div>

    <div class="border-bottom">
        <!--        <img src="img/index/computer_icon.png" alt=""/>-->
        <span class="title_font">书友推荐</span>
    </div>
    <!--    <div class="album py-5 bg-light">-->
    <div class="container" id="bookDisplayPanel4">
        <div class="row">
            <div class="col-md-4">
                <div class="card mb-4 shadow-sm">
                    <img src="#" alt="" class="book-img">
                    <div class="card-body-book">
                        <div class="book-info">
                            <p hidden="hidden"></p>
                            <p class="book-title"></p>
                            <p class="book-author"></p>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="watchDetail(this)">查看</button>
                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="addCart(this)">加入购物车</button>
                            </div>
                            <!--                                <small class="text-muted">9 mins</small>-->
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card mb-4 shadow-sm">
                    <img src="#" alt="" class="book-img">
                    <div class="card-body-book">
                        <div class="book-info">
                            <p hidden="hidden"></p>
                            <p class="book-title"></p>
                            <p class="book-author"></p>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-outline-secondary">查看</button>
                                <button type="button" class="btn btn-sm btn-outline-secondary">加入购物车</button>
                            </div>
                            <!--                                <small class="text-muted">9 mins</small>-->
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card mb-4 shadow-sm">
                    <img src="#" alt="" class="book-img">
                    <div class="card-body-book">
                        <div class="book-info">
                            <p hidden="hidden"></p>
                            <p class="book-title"></p>
                            <p class="book-author"></p>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-outline-secondary">查看</button>
                                <button type="button" class="btn btn-sm btn-outline-secondary">加入购物车</button>
                            </div>
                            <!--                                <small class="text-muted">9 mins</small>-->
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card mb-4 shadow-sm">
                    <img src="#" alt="" class="book-img">
                    <div class="card-body-book">
                        <div class="book-info">
                            <p hidden="hidden"></p>
                            <p class="book-title"></p>
                            <p class="book-author"></p>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-outline-secondary">查看</button>
                                <button type="button" class="btn btn-sm btn-outline-secondary">加入购物车</button>
                            </div>
                            <!--                                <small class="text-muted">9 mins</small>-->
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card mb-4 shadow-sm">
                    <img src="#" alt="" class="book-img">
                    <div class="card-body-book">
                        <div class="book-info">
                            <p hidden="hidden"></p>
                            <p class="book-title"></p>
                            <p class="book-author"></p>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-outline-secondary">查看</button>
                                <button type="button" class="btn btn-sm btn-outline-secondary">加入购物车</button>
                            </div>
                            <!--                                <small class="text-muted">9 mins</small>-->
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card mb-4 shadow-sm">
                    <img src="#" alt="" class="book-img">
                    <div class="card-body-book">
                        <div class="book-info">
                            <p hidden="hidden"></p>
                            <p class="book-title"></p>
                            <p class="book-author"></p>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-outline-secondary">查看</button>
                                <button type="button" class="btn btn-sm btn-outline-secondary">加入购物车</button>
                            </div>
                            <!--                                <small class="text-muted">9 mins</small>-->
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card mb-4 shadow-sm">
                    <img src="#" alt="" class="book-img">
                    <div class="card-body-book">
                        <div class="book-info">
                            <p hidden="hidden"></p>
                            <p class="book-title"></p>
                            <p class="book-author"></p>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-outline-secondary">查看</button>
                                <button type="button" class="btn btn-sm btn-outline-secondary">加入购物车</button>
                            </div>
                            <!--                                <small class="text-muted">9 mins</small>-->
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card mb-4 shadow-sm">
                    <img src="#" alt="" class="book-img">
                    <div class="card-body-book">
                        <div class="book-info">
                            <p hidden="hidden"></p>
                            <p class="book-title"></p>
                            <p class="book-author"></p>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-outline-secondary">查看</button>
                                <button type="button" class="btn btn-sm btn-outline-secondary">加入购物车</button>
                            </div>
                            <!--                                <small class="text-muted">9 mins</small>-->
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card mb-4 shadow-sm">
                    <img src="#" alt="" class="book-img">
                    <div class="card-body-book">
                        <div class="book-info">
                            <p hidden="hidden"></p>
                            <p class="book-title"></p>
                            <p class="book-author"></p>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-outline-secondary">查看</button>
                                <button type="button" class="btn btn-sm btn-outline-secondary">加入购物车</button>
                            </div>
                            <!--                                <small class="text-muted">9 mins</small>-->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 分割线 -->
    <hr color="#ffffff" />

    <!-- 底部footer -->
    <ul class="list-unstyled d-flex justify-content-around" id="footer_upper">
        <li>
            <img src="img/zhengpin.png" alt=""/>
            <p>正规渠道，正品保障</p>
        </li>
        <li>
            <img src="img/peisong.png" alt=""/>
            <p>多仓直发，极速配送</p>
        </li>
        <li>
            <img src="img/huodaofukuan.png" alt=""/>
            <p>放心购物，货到付款</p>
        </li>
        <li>
            <img src="img/pinleiqiquan.png" alt=""/>
            <p>品类齐全，轻松购物</p>
        </li>
    </ul>
    <footer>
        <div class="row">
            <!--6个ul-->
            <div class="col-2">
                <h6 class="text-center">购物指南</h6>
                <ul class="list-unstyled">
                    <li class="text-center"><a href="" class="text-muted">购物流程</a></li>
                    <li class="text-center"><a href="" class="text-muted">常见问题</a></li>
                    <li class="text-center"><a href="" class="text-muted">联系客服</a></li>
                </ul>
            </div>
            <div class="col-2">
                <h6 class="text-center">支付方式</h6>
                <ul class="list-unstyled">
                    <li class="text-center"><a href="" class="text-muted">网上支付</a></li>
                    <li class="text-center"><a href="" class="text-muted">礼品卡支付</a></li>
                    <li class="text-center"><a href="" class="text-muted">货到付款</a></li>
                </ul>
            </div>
            <div class="col-2">
                <h6 class="text-center">配送方式</h6>
                <ul class="list-unstyled">
                    <li class="text-center"><a href="" class="text-muted">上门自提</a></li>
                    <li class="text-center"><a href="" class="text-muted">配送到家</a></li>
                    <li class="text-center"><a href="" class="text-muted">限时达</a></li>
                    <li class="text-center"><a href="" class="text-muted">海外配送</a></li>
                </ul>
            </div>
            <div class="col-2">
                <h6 class="text-center">售后服务</h6>
                <ul class="list-unstyled">
                    <li class="text-center"><a href="" class="text-muted">售后政策</a></li>
                    <li class="text-center"><a href="" class="text-muted">退款说明</a></li>
                    <li class="text-center"><a href="" class="text-muted">价格保护</a></li>
                    <li class="text-center"><a href="" class="text-muted">退/换货</a></li>
                    <li class="text-center"><a href="" class="text-muted">取消订单</a></li>
                </ul>
            </div>
            <div class="col-2">
                <h6 class="text-center">商家服务</h6>
                <ul class="list-unstyled">
                    <li class="text-center"><a href="" class="text-muted">商家中心</a></li>
                    <li class="text-center"><a href="" class="text-muted">运营服务</a></li>
                </ul>
            </div>
            <div class="col-2">
                <h6 class="text-center">特色服务</h6>
                <ul class="list-unstyled">
                    <li class="text-center"><a href="" class="text-muted">二手书商城</a></li>
                    <li class="text-center"><a href="" class="text-muted">图书交流论坛</a></li>
                    <li class="text-center"><a href="" class="text-muted">图书发布会</a></li>
                </ul>
            </div>
        </div>
        <!-- 版权信息-->
        <div class="text-center">©2017 达内集团有限公司 版权所有 京ICP证xxxxxxxxxxx</div>
    </footer>
</div>
</body>
</html>